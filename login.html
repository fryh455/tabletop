<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<title>Login â€” Tabletop</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="loginBox">
    <h2>Entrar / Registrar</h2>

    <div class="form-row">
      <input id="email" placeholder="Email" type="email" />
    </div>
    <div class="form-row">
      <input id="password" placeholder="Senha" type="password" />
    </div>
    <div class="form-row">
      <select id="role">
        <option value="player">Player</option>
        <option value="mestre">Mestre</option>
      </select>
    </div>

    <div class="form-row">
      <button id="btnRegister">Registrar</button>
      <button id="btnLogin">Entrar</button>
    </div>

    <div id="loginMsg"></div>
  </div>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
  /* ==== Config (mesma do projeto) ==== */
  firebase.initializeApp({
    apiKey: "AIzaSyBjSCYNOngXOSQGBU7jMj1kgf7hunfMjyI",
    authDomain: "marionetes-do-destino.firebaseapp.com",
    databaseURL: "https://marionetes-do-destino-default-rtdb.firebaseio.com",
    projectId: "marionetes-do-destino"
  });

  const auth = firebase.auth();
  const db = firebase.database();
  const usersRef = db.ref("users");

  const email = document.getElementById("email");
  const password = document.getElementById("password");
  const role = document.getElementById("role");
  const msg = document.getElementById("loginMsg");

  document.getElementById("btnRegister").onclick = async () => {
    msg.textContent = "";
    if(!email.value || !password.value){ msg.textContent = "Preencha email e senha"; return; }
    try{
      const cred = await auth.createUserWithEmailAndPassword(email.value, password.value);
      await usersRef.child(cred.user.uid).set({ email: email.value, role: role.value });
      msg.textContent = "Registrado. Redirecionando...";
      setTimeout(()=> location.href = "index.html", 600);
    }catch(err){ msg.textContent = "Erro: " + err.message; }
  };

  document.getElementById("btnLogin").onclick = async () => {
    msg.textContent = "";
    if(!email.value || !password.value){ msg.textContent = "Preencha email e senha"; return; }
    try{
      await auth.signInWithEmailAndPassword(email.value, password.value);
      msg.textContent = "Logado. Redirecionando...";
      setTimeout(()=> location.href = "index.html", 400);
    }catch(err){ msg.textContent = "Erro: " + err.message; }
  };

  // redirect if already logged
  auth.onAuthStateChanged(user=>{
    if(user) location.href = "index.html";
  });
  </script>
</body>
</html>
