<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Tabletop Test Map</title>
<style>
  html, body { margin: 0; padding: 0; height: 100%; background: #111; color: white; font-family: sans-serif; overflow: hidden; }
  
  #viewport { width: 100%; height: 100%; overflow: hidden; position: relative; cursor: grab; }
  #world { position: absolute; transform-origin: 0 0; }
  
  /* MAPA SIMPLES: gradiente para teste */
  #map {
    width: 2000px;
    height: 2000px;
    background: radial-gradient(circle at center, #444 0%, #111 100%);
    position: absolute;
    top: 0; left: 0;
  }
  
  .token {
    width: 50px;
    height: 50px;
    background: crimson;
    border-radius: 50%;
    position: absolute;
    cursor: pointer;
    user-select: none;
  }

  #sheet {
    position: fixed;
    bottom: 10px;
    left: 10px;
    background: #222;
    padding: 10px;
    border: 1px solid #555;
    display: none;
    z-index: 1000;
  }

  #ui { position: fixed; top: 10px; right: 10px; z-index: 1000; }
  #ui button { padding: 8px 12px; margin-bottom: 6px; cursor: pointer; }
</style>
</head>
<body>

<div id="ui">
  <button id="createToken">Criar token</button>
</div>

<div id="sheet"></div>

<div id="viewport">
  <div id="world">
    <div id="map"></div>
  </div>
</div>

<script>
  const viewport = document.getElementById("viewport");
  const world = document.getElementById("world");
  const sheet = document.getElementById("sheet");

  let scale = 1, offsetX = 0, offsetY = 0;

  function updateTransform() {
    world.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
  }

  /* DRAG MAP */
  let draggingMap = false, startX, startY;
  viewport.addEventListener("mousedown", e => {
    if(e.target.classList.contains("token")) return;
    draggingMap = true;
    startX = e.clientX - offsetX;
    startY = e.clientY - offsetY;
    viewport.style.cursor = "grabbing";
  });
  window.addEventListener("mouseup", () => { draggingMap = false; viewport.style.cursor = "grab"; });
  window.addEventListener("mousemove", e => {
    if(!draggingMap) return;
    offsetX = e.clientX - startX;
    offsetY = e.clientY - startY;
    updateTransform();
  });

  /* ZOOM */
  viewport.addEventListener("wheel", e => {
    e.preventDefault();
    const delta = e.deltaY < 0 ? 1.1 : 0.9;
    scale = Math.min(Math.max(scale*delta, 0.3), 3);
    updateTransform();
  }, { passive:false });

  /* TOKENS */
  function createTokenElement(id, x=300, y=300) {
    let el = document.getElementById(id);
    if(!el) {
      el = document.createElement("div");
      el.className = "token";
      el.id = id;
      world.appendChild(el);

      let dragging = false, dx, dy;

      el.addEventListener("mousedown", e => { e.stopPropagation(); dragging=true; dx=e.offsetX; dy=e.offsetY; });
      window.addEventListener("mousemove", e => {
        if(!dragging) return;
        el.style.left = ((e.clientX - offsetX)/scale - dx) + "px";
        el.style.top  = ((e.clientY - offsetY)/scale - dy) + "px";
      });
      window.addEventListener("mouseup", ()=>dragging=false);

      el.addEventListener("click", e => {
        e.stopPropagation();
        sheet.style.display = "block";
        sheet.innerHTML = `<strong>Ficha Token</strong><br>ID: ${id}<br>X: ${Math.round(parseFloat(el.style.left))}<br>Y: ${Math.round(parseFloat(el.style.top))}`;
      });
    }
    el.style.left = x + "px";
    el.style.top = y + "px";
  }

  document.getElementById("createToken").onclick = () => {
    const id = "token_" + Date.now();
    createTokenElement(id);
  }
</script>
</body>
</html>

